<!DOCTYPE html>
<html>
<head>
  <title>Videos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f6f7fb; }
    .thumb { width: 160px; height: 90px; object-fit: cover; border-radius: 10px; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-white border-bottom">
  <div class="container">
    <a class="navbar-brand" href="/">Home</a>
    <div class="ms-auto d-flex gap-2 align-items-center">
      <span class="text-muted small"><%= user.fullName %> â€¢ <%= user.email %></span>
      <form method="POST" action="/logout" class="m-0">
        <button class="btn btn-outline-danger btn-sm" type="submit">Logout</button>
      </form>
    </div>
  </div>
</nav>

<div class="container py-4">
  <h3 class="mb-3">YouTube Search</h3>

  <% if (error) { %>
    <div class="alert alert-warning"><%= error %></div>
  <% } %>

  <form method="GET" action="/videos" class="row g-2 mb-4">
    <div class="col-md-9">
      <input class="form-control" name="q" value="<%= query %>" placeholder="Search on YouTube..." />
    </div>
    <div class="col-md-3 d-grid">
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
  </form>

  <% if (results && results.length) { %>
    <div class="row g-3 mb-5">
      <% results.forEach(v => { %>
        <div class="col-12">
          <div class="card">
            <div class="card-body d-flex gap-3 align-items-start">
              <img class="thumb" src="<%= v.thumbnailUrl %>" alt="thumb" />
              <div class="flex-grow-1">
                <div class="fw-semibold"><%= v.title %></div>
                <div class="text-muted small"><%= v.channelTitle %></div>
                <a class="small" target="_blank" href="https://www.youtube.com/watch?v=<%= v.videoId %>">Open on YouTube</a>
              </div>
              <form method="POST" action="/favorites/add">
                <input type="hidden" name="videoId" value="<%= v.videoId %>"/>
                <input type="hidden" name="title" value="<%= v.title %>"/>
                <input type="hidden" name="channelTitle" value="<%= v.channelTitle %>"/>
                <input type="hidden" name="thumbnailUrl" value="<%= v.thumbnailUrl %>"/>
                <button class="btn btn-success" type="submit">Add</button>
              </form>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>

  <h3 class="mb-3">My Favorites</h3>

  <% if (!favorites.length) { %>
    <div class="text-muted">No favorites yet.</div>
  <% } %>

  <div class="row g-3">
    <% favorites.forEach(f => { %>
      <div class="col-12">
        <div class="card">
          <div class="card-body d-flex gap-3 align-items-start">
            <img class="thumb" src="<%= f.thumbnailUrl %>" alt="thumb" />
            <div class="flex-grow-1">
              <div class="fw-semibold"><%= f.title %></div>
              <div class="text-muted small"><%= f.channelTitle %></div>
              <a class="small" target="_blank" href="https://www.youtube.com/watch?v=<%= f.videoId %>">Open on YouTube</a>
            </div>
            <form method="POST" action="/favorites/<%= f.id %>/delete">
              <button class="btn btn-outline-danger" type="submit">Delete</button>
            </form>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
